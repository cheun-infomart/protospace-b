<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
  <head>
    <th:block th:replace="~{common/head :: head}"></th:block>
  </head>
  <body>
    <header th:replace="~{common/header :: header}"></header>

    <!--詳細エリア-->
    <div class="prototype-show-details">
      <div class="prototype-show-container">
        <div class="prototype-show-header">
          <h3 class="title-h2" th:text="${prototype.name}"></h3>
          <div class="prototype-show-user-and-like">
            <div th:replace="~{common/like :: like}"></div>
            <a
              th:href="@{/users/{id}(id=${prototype.user.id})}"
              class="prototype-show-author"
              th:text="'by ' + ${prototype.user.name}"
            ></a>
          </div>

          <!--ログイン状態かつ自分の投稿かでボタンの表示変更-->
          <div
            th:if="${#authorization.expression('isAuthenticated()') and #authentication.principal.getId == prototype.user.id}"
          >
            <div class="prototype-show-button-section">
              <a
                th:href="@{/prototypes/{id}/edit(id=${prototype.id})}"
                class="prototype-show-btn"
                >編集する</a
              >
              <form
                th:action="@{/prototypes/{prototypeId}/delete(prototypeId=${prototype.id})}"
                th:method="post"
              >
                <input
                  type="submit"
                  class="prototype-show-btn"
                  value="削除する"
                />
              </form>
            </div>
          </div>
        </div>
        <!-- メイン画像 -->
        <div class="prototype-show-image">
          <img th:src="@{${prototype.image}}" alt="メッセージ画像" />
        </div>
      </div>

      <div class="prototype-show-description">
        <div class="prototype-show-info-group">
          <h3 class="prototype-show-info-label">キャッチコピー</h3>
          <p
            class="prototype-show-info-text"
            th:text="${prototype.catchCopy}"
          ></p>
        </div>
        <div class="prototype-show-info-group">
          <h3 class="prototype-show-info-label">コンセプト</h3>
          <p
            class="prototype-show-info-text"
            th:text="${prototype.concept}"
          ></p>
        </div>

        <!--コメントエリア-->
        <div class="prototype-show-comment-section">
          <div th:if="${#authorization.expression('isAuthenticated()')}">
            <div
              th:if="${errorMessages}"
              th:each="error : ${errorMessages}"
              class="new-error"
            >
              <div th:text="${error.defaultMessage}"></div>
            </div>
            <form
              th:action="@{/prototypes/{prototypeId}/comment(prototypeId=${prototype.id})}"
              method="post"
              th:object="${commentForm}"
              class="prototype-show-comment-form"
            >
              <label for="comment" class="prototype-show-comment-label"
                >コメント</label
              >
              <input
                class="prototype-show-comment-input"
                th:field="*{text}"
                type="text"
                id="comment"
              />
              <input class="com-btn" type="submit" value="送信する" />
            </form>
          </div>
          <div th:if="${#authorization.expression('!isAuthenticated()')}">
            <strong>
              <p>※※※ コメントの投稿には新規登録/ログインが必要です ※※※</p>
            </strong>
          </div>

          <ul class="prototype-show-comments">
            <li th:each="comment:${comments}" class="prototype-show-comment">
              <span
                class="prototype-show-comment-text"
                th:text="${comment.text}"
              ></span>
              <a
                th:href="@{/users/{userId}(userId=${comment.user.id})}"
                th:text="${comment.user.name}"
                class="prototype-show-comment-user"
              ></a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <footer th:replace="~{common/footer :: footer}"></footer>
  </body>
  <script th:inline="javascript" th:if="${errorMessage}">
    /*<![CDATA[*/
    const message = /*[[${errorMessage}]]*/ "error";
    alert(message);
    /*]]>*/
  </script>
</html>
